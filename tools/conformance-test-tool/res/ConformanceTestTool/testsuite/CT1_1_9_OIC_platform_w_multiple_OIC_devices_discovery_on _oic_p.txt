*** Settings ***
Documentation	CT1.1.9 OIC platform w/ multiple OIC devices-discovery on /oic/p
Resource	OIC_ConformanceTest_Setting.txt

*** Test Cases ***
CT1.1.9 OIC platform w/ multiple OIC devices-discovery on /oic/p
    [Documentation]					
	...	|author	| |		
	...	|reviewer| |				
	...	|since	|2015-05-11 |
	...	|see	|Section 11.3 |
	...	|objective	|Verify the Server (DUT) properly responds with the right values for /oic/p parameters on all OIC devices. |
	...	|target	|Server DUT |
	...	|test_data|CoAP Based Unicast Discovery on valid resource |
	...	|pre_condition	|Server (DUT) is discoverable from the Client (TE) |
	...	|procedure	|1. Connected / discoverable |
	...	|procedure	|2. Use the Test Application to initiate a unicast discovery request on /oic/p Case 1: On OIC Server 1 Case 2: OIC Server 2 Case 3: OIC Server 3 Etc. |
	...	|procedure	|3. Sends discovery response |
	...	|procedure	|4. Displays discovered resources |
	...	|post_condition	|None |
	...	|expected	|1. The format of returned resources against the correct JSON schema |
	...	|expected	|2. The values of the properties exposed are the same for all the servers |


#Pre-Condition
    Set Log File Directory      ${TESTNAME}
    ${DUT1_ID} =        Set Variable    Server_DUT1
    ${define_dut_result}        Define DUT Information          ${DUT1_ID}      ${DUT1_INFO_PATH}       ${DUT_TYPE_SERVER}
    Should Be True      ${define_dut_result}
    @{dut1_resource_types}      Get DUT Info Value      ${RESOURCE_TYPE}        ${DUT1_ID}      ${DISCOVERABLE}=1
    :FOR       ${dut1_resource_type}   IN      @{dut1_resource_types}
    \   ${resource_ip}  ${resource_port}        ${resource_href}        Get IP Port And Uri             ${RESOURCE_TYPE}=${dut1_resource_type}

#Test-Body
    ${msgid}    Generate Message Id
    ${token}    Generate Token
    ${dut1_response}                Discover Resource Using Unicast         ${UNICAST}      ${COAP}    ${msgid}    ${token}          ${resource_ip}     ${${resource_port}}      ${OIC_CORE_RESOURCE_PLATFORM_URI}        ${NON_CONFIRMABLE}
    Should Not Be Empty             ${dut1_response}
    ${dut1_response_json}   Get Response Json       ${dut1_response}
    ${validate_json_result}         Validate JSON Format        ${dut1_response_json}
    Should Be True          ${validate_json_result}
    ${dut1_response_code}   Get Response Code       ${dut1_response}
    Should Be Equal         ${COAP_RESPONSE_CODE_SUCCESS}   ${dut1_response_code}
    ${response_href}    Get Json Value    ${HREF}     ${dut1_response_json}
    Should Contain    ${response_href}    ${OIC_CORE_RESOURCE_PLATFORM_URI}
    Check Representation    ${DUT1_ID}      ${dut1_response_json}   Json   ${DISCOVERABLE}=1                @{REPRESENTATION_OIC_P}

    ${msgid}    Generate Message Id
    ${token}    Generate Token
    ${dut1_response}                Discover Resource Using Unicast         ${UNICAST}      ${COAP}     ${msgid}    ${token}     ${resource_ip}     ${${resource_port}}      ${OIC_CORE_RESOURCE_PLATFORM_URI}        ${CONFIRMABLE}
    Should Not Be Empty             ${dut1_response}
    ${dut1_response_json}   Get Response Json       ${dut1_response}
    ${validate_json_result}         Validate JSON Format        ${dut1_response_json}
    Should Be True          ${validate_json_result}
    ${dut1_response_code}   Get Response Code       ${dut1_response}
    Should Be Equal         ${COAP_RESPONSE_CODE_SUCCESS}   ${dut1_response_code}
    ${response_href}    Get Json Value    ${HREF}     ${dut1_response_json}
    Should Contain    ${response_href}    ${OIC_CORE_RESOURCE_PLATFORM_URI}
    Check Representation    ${DUT1_ID}      ${dut1_response_json}   Json   ${DISCOVERABLE}=1                @{REPRESENTATION_OIC_P}

    Release DUT information     ${DUT1_ID}
