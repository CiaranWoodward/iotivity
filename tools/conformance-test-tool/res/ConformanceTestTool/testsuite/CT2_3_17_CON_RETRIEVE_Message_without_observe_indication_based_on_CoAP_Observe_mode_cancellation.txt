*** Settings ***
Documentation     CT2_3_17_CON_RETRIEVE_Message_without_observe_indication_based_on_CoAP_Observe_mode_cancellation
Resource          OIC_ConformanceTest_Setting.txt

*** Test Cases ***
CT2_3_17_CON_RETRIEVE_Message_without_observe_indication_based_on_CoAP_Observe_mode_cancellation
    [Documentation]    |author | |
    ...    |reviewer| |
    ...    |since |2015-05-11|
    ...    |see |Section 11.4: NOTIFICATION|
    ...    |objective |Verify that the client (DUT) properly sends a CON RETRIEVE request without observe indication from server (TE).|
    ...    |target | |
    ...    |test_data||
    ...    |pre_condition|1. Server (TE) is discovered from the Client (DUT)|
    ...    |pre_condition|| 2. Resource properties and attribute contents are known for verification|
    ...    |pre_condition|| 3. Server (TE) is in observe mode|
    ...    |procedure| 1. Send a CON (high QoS) RETRIEVE request message to server (without observe field to the same resource)|
    ...    |procedure| 2. Reply with RETRIEVE response message to client|
    ...    |post_condition| |
    ...    |expected| 1. Verify Client sends the request message including below|
    ...    |expected| In OIC Layer|
    ...    |expected| - fr, to, ri, cn, op|
    ...    |expected| - op = RETRIEVE|
    ...    |expected| - cn Information, including properties, of the resource to be updated |
    ...    |expected| In CoAP Layer|
    ...    |expected| - Type = 0 (CON)|
    ...    |expected| - Code = 1 (GET) - observe flag in option field|

    [Tags]    Mandatory    Client    Retrieve    Observe    Cancelation    Con
    #Pre-Condition
    ####################################################
    Start Server
    ConformanceKeyword.Log To Console    \n-----------------Send Multicast Discovery Request from DUT App-----------------
    Get Discovery Requests
    #Test-Body
    #####################################################
    ConformanceKeyword.Log To Console    \n-----------------Send Observe Resource Request from DUT App-----------------
    Get Request
    ConformanceKeyword.Log To Console    \n-----------------Send CON RETRIEVE Request Without Observe Indication from DUT App-----------------
    ${request}    Get Request
    ${request_code}    Get Request Code    ${request}
    Should Be Equal    ${request_code}    ${GET}
    ${request_type}    Get Request Type    ${request}
    Should Be Equal    ${request_type}    ${CON}
    ${payload}    Get Request Json    ${request}
    Should Be Empty        ${payload}
    ${request_observe}    Get Request Observe    ${request}
    Should Be Empty    ${request_observe}
    Stop Server
