*** Settings ***
Documentation     CT2_3_12_NON_UPDATE_Collection_Resource_based_on_CoAP
Resource          OIC_ConformanceTest_Setting.txt
Test Setup    Start Capture
Test TearDown    End Capture

*** Test Cases ***
CT2_3_12_NON_UPDATE_Collection_Resource_based_on_CoAP
    [Documentation]    |author | |
    ...    |reviewer| |
    ...    |since |2015-05-11|
    ...    |see |Section 8.3: UPDATE; Section 12.2.2|
    ...    |objective |Verify that the client (DUT) properly sends a NON UPDATE to post a resource to a collection on a server (TE) |
    ...    |target | |
    ...    |test_data||
    ...    |pre_condition|1. Server (TE) is discovered from the Client (DUT) |
    ...    |pre_condition|2. A resource collection exists |
    ...    |pre_condition|3. A standalone resource exists |
    ...    |procedure| 1. Send a NON (low QoS) UPDATE request message to post the standalone resource to be a subordinate resource of the resource collection on the server |
    ...    |procedure| 2. Reply with UPDATE response message to client|
    ...    |post_condition| |
    ...    |expected| 1. Verify Client sends the request message including below|
    ...    |expected| In OIC Layer|
    ...    |expected| - fr, to, ri, cn, op|
    ...    |expected| - op = UPDATE|
    ...    |expected| - cn Information, including properties, of the resource to be updated |
    ...    |expected| In CoAP Layer|
    ...    |expected| - Type = 1 (NON)|
    ...    |expected| - Code = 2 (POST)|
    ...    |expected| The payload of this PUT includes the initial state of the resource.|
    [Tags]    Mandatory    Client    Update    Non
    #Pre-Condition
    ####################################################
    Start Server
    Print Message    \n-----------------Send Multicast Discovery Request from DUT App-----------------
    Get Discovery Requests
    #Test-Body
    #####################################################
    Print Message    \n-----------------Send NON Partial UPDATE Request from DUT App-----------------
    ${request}    Get Request
    ${request_code}    Get Request Code    ${request}
    Should Be Equal    ${request_code}    ${POST}
    ${request_type}    Get Request Type    ${request}
    Should Be Equal    ${request_type}    ${NON}
    ${payload}    Get Request Json    ${request}
    ${validate_json_result}    Validate JSON Format    ${payload} 
    Should Be True    ${validate_json_result}
    ${resource_representation}    Get JSON Value    ${REPRESENTATION}    ${payload}
    Should Not be Empty    ${resource_representation}
    Stop Server  

